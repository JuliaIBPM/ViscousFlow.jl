<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic viscous flow · ViscousFlow.jl</title><meta name="title" content="Basic viscous flow · ViscousFlow.jl"/><meta property="og:title" content="Basic viscous flow · ViscousFlow.jl"/><meta property="twitter:title" content="Basic viscous flow · ViscousFlow.jl"/><meta name="description" content="Documentation for ViscousFlow.jl."/><meta property="og:description" content="Documentation for ViscousFlow.jl."/><meta property="twitter:description" content="Documentation for ViscousFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ViscousFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Basic viscous flow</a><ul class="internal"><li><a class="tocitem" href="#A-basic-example:-the-Lamb-Oseen-vortex"><span>A basic example: the Lamb-Oseen vortex</span></a></li><li><a class="tocitem" href="#Second-example:-co-rotating-vortices"><span>Second example: co-rotating vortices</span></a></li></ul></li><li><a class="tocitem" href="../2.-Basic-flow-with-a-stationary-body/">Basic flow with a stationary body</a></li><li><a class="tocitem" href="../3.-Applying-pulse-forcing-to-a-flow/">Applying pulse forcing to a flow</a></li><li><a class="tocitem" href="../4.-Multiple-stationary-bodies/">Multiple stationary bodies</a></li><li><a class="tocitem" href="../5.-Moving-reference-frame/">Moving reference frame</a></li><li><a class="tocitem" href="../6.-Viscous-flow-about-a-moving-body/">Viscous flow about moving bodies</a></li><li><a class="tocitem" href="../7.-Variable-free-stream/">Variable free stream</a></li><li><a class="tocitem" href="../8.-Lid-driven-cavity/">Lid-driven cavity flow</a></li><li><a class="tocitem" href="../9.-Exogenous-degrees-of-freedom/">Exogenous degrees of freedom</a></li><li><a class="tocitem" href="../functions/">Functions and types</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Basic viscous flow</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic viscous flow</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl/blob/master/test/literate/1.-Basic-viscous-flow.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-viscous-flow"><a class="docs-heading-anchor" href="#Basic-viscous-flow">Basic viscous flow</a><a id="Basic-viscous-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-viscous-flow" title="Permalink"></a></h1><p>In this example, we will simulate various examples of a basic <em>unbounded</em> viscous flow–-a flow without boundaries. Our initial condition will be a distribution of <em>vorticity</em>.</p><pre><code class="language-julia hljs">using ViscousFlow</code></pre><pre><code class="language-julia hljs">using Plots</code></pre><h3 id="The-basic-steps"><a class="docs-heading-anchor" href="#The-basic-steps">The basic steps</a><a id="The-basic-steps-1"></a><a class="docs-heading-anchor-permalink" href="#The-basic-steps" title="Permalink"></a></h3><p>To carry out any simulation in <code>ViscousFlow</code>, we need to carry out a few basic steps:</p><ul><li><strong>Specify the problem</strong>: Set the Reynolds number, the free stream, and any other problem parameters</li><li><strong>Discretize</strong>: Set up a solution domain, choose the grid Reynolds number and the critical time step limits</li><li><strong>Construct the system structure</strong>: Create the operators that will be used to perform the simulation</li><li><strong>Initialize</strong>: Set the initial flow field and initialize the integrator</li><li><strong>Solve</strong>: Solve the flow field</li><li><strong>Examine</strong>: Examine the results</li></ul><p>We will go through all of these here. For the examples we will carry out in this notebook, the first two steps need only be carried out once.</p><p>The package utilizes parameters arranged into a dictionary, or <code>Dict</code>. The dictionary associates names (or <em>keys</em>) with values. Most of these key have standardizes names. We will describe the entries in this as we go, adding them in one at a time for expositional purposes. We initializing it first and call it <code>my_params</code> for this example.</p><pre><code class="language-julia hljs">my_params = Dict()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Any, Any}()</code></pre><h3 id="Problem-specification"><a class="docs-heading-anchor" href="#Problem-specification">Problem specification</a><a id="Problem-specification-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-specification" title="Permalink"></a></h3><p>We will set the Reynolds number to be 200 and no free stream. The Reynolds number key is &quot;Re&quot;. If we had a free stream, then we would set this with two keys: &quot;freestream speed&quot; and &quot;freestream angle&quot;. They default to zero if we don&#39;t put anything into the dictionary. But we always have to put in the Reynolds number.</p><pre><code class="language-julia hljs">my_params[&quot;Re&quot;] = 200</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">200</code></pre><h3 id="Discretize"><a class="docs-heading-anchor" href="#Discretize">Discretize</a><a id="Discretize-1"></a><a class="docs-heading-anchor-permalink" href="#Discretize" title="Permalink"></a></h3><p>We will set up a domain from x = -2 to x = 2, and y = -2 to y = 2. The Reynolds number helps us determine the grid spacing and time step size. To set these, we set a target <em>grid Reynolds number</em>, with the key &quot;grid Re&quot;. We will set this to 4 here; if we don&#39;t set it, it defaults to 2. Note that the choice we make here is a compromise:</p><ul><li>smaller grid Reynolds number means smaller grid spacing, but slower simulations</li><li>larger grid Reynolds number means less accurate results</li></ul><pre><code class="language-julia hljs">xlim = (-2.0,2.0)
ylim = (-2.0,2.0)
my_params[&quot;grid Re&quot;] = 4.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4.0</code></pre><p>Then we set up the grid</p><pre><code class="language-julia hljs">g = setup_grid(xlim,ylim,my_params)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PhysicalGrid{2}((208, 208), (104, 104), 0.02, ((-2.06, 2.06), (-2.06, 2.06)), 2)</code></pre><h3 id="Construct-the-system-structure"><a class="docs-heading-anchor" href="#Construct-the-system-structure">Construct the system structure</a><a id="Construct-the-system-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Construct-the-system-structure" title="Permalink"></a></h3><p>This part is easy - you supply the parameters you have just set up. It returns a structure with all of the necessary mathematical operators:</p><pre><code class="language-julia hljs">sys = viscousflow_system(g,phys_params=my_params);</code></pre><p>This is now ready to solve any unbounded viscous flow problems. Now, we will solve a few different problems to see how it works.</p><h2 id="A-basic-example:-the-Lamb-Oseen-vortex"><a class="docs-heading-anchor" href="#A-basic-example:-the-Lamb-Oseen-vortex">A basic example: the Lamb-Oseen vortex</a><a id="A-basic-example:-the-Lamb-Oseen-vortex-1"></a><a class="docs-heading-anchor-permalink" href="#A-basic-example:-the-Lamb-Oseen-vortex" title="Permalink"></a></h2><p>This example starts with a single vortex with a Gaussian distribution of vorticity. To generate this, will use the <code>SpatialGaussian</code> function: The command below creates a Gaussian with radius σ at (0,0) with strength 1.</p><pre><code class="language-julia hljs">σ = 0.2
x0 = 0.0
y0 = 0.0
A = 1
gauss = SpatialGaussian(σ,σ,x0,y0,A)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SpatialGaussian{false, 0}([0.04000000000000001 0.0; 0.0 0.04000000000000001], [24.999999999999996 -0.0; -0.0 24.999999999999996], [0.0, 0.0], 1.0, 3.9788735772973833, [0.0, 0.0])</code></pre><h3 id="Initialize"><a class="docs-heading-anchor" href="#Initialize">Initialize</a><a id="Initialize-1"></a><a class="docs-heading-anchor-permalink" href="#Initialize" title="Permalink"></a></h3><p>Now, we create an instance of this vorticity distribution on the grid by calling <a href="https://juliaibpm.github.io/ImmersedLayers.jl/stable/manual/heatconduction/#ImmersedLayers.init_sol"><code>init_sol</code></a> with this vortex.</p><pre><code class="language-julia hljs">u0 = init_sol(gauss,sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Dual nodes in a (nx = 208, ny = 208) cell grid of type Float64 data
  Number of Dual nodes: (nx = 208, ny = 208), Float64[])</code></pre><p>We use this initial condition to initialize the <strong>integrator</strong>. The integrator is the structure that holds all of our solution and operator information. With it, we can start the simulation, restart the simulation later, etc. We specify a range of time over which to advance the solution.</p><p><strong>Note</strong>: This range need only be large enough to contain the whole interval of time we wish to simulate. It does not need to be chosen very precisely.</p><p><strong>Note 2</strong>: There is no need to restart the problem! We can keep applying the <code>step!</code> function below as long we need.</p><pre><code class="language-julia hljs">tspan = (0.0,10.0)
integrator = init(u0,tspan,sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">t: 0.0
u: (Dual nodes in a (nx = 208, ny = 208) cell grid of type Float64 data
  Number of Dual nodes: (nx = 208, ny = 208), Float64[])</code></pre><h3 id="Solve"><a class="docs-heading-anchor" href="#Solve">Solve</a><a id="Solve-1"></a><a class="docs-heading-anchor-permalink" href="#Solve" title="Permalink"></a></h3><p>Now we are ready to solve the problem. Let&#39;s advance the solution to <span>$t = 1$</span>:</p><pre><code class="language-julia hljs">step!(integrator,1.0)</code></pre><p>We can see now that the solution has been advanced in time:</p><pre><code class="language-julia hljs">integrator</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">t: 1.0000000000000007
u: (Dual nodes in a (nx = 208, ny = 208) cell grid of type Float64 data
  Number of Dual nodes: (nx = 208, ny = 208), Float64[])</code></pre><h3 id="Examine"><a class="docs-heading-anchor" href="#Examine">Examine</a><a id="Examine-1"></a><a class="docs-heading-anchor-permalink" href="#Examine" title="Permalink"></a></h3><p>Let&#39;s examine the results. It is important to show a few different ways that we can do this. The most straightforward way is to just look at the flow fields at the current state of the integrator. For example, to get the current velocity field, type <code>velocity(integrator)</code>. We can do the same for <code>vorticity</code>, <code>streamfunction</code> (the streamlines), <code>scalarpotential</code>, <code>convective_derivative</code>, and <code>pressure</code>.</p><p>We will look at some of these at the current state:</p><pre><code class="language-julia hljs">plot(
plot(vorticity(integrator),sys,title=&quot;Vorticity&quot;),
plot(streamfunction(integrator),sys,title=&quot;Streamlines&quot;),
plot(pressure(integrator),sys,title=&quot;Pressure&quot;),
plot(velocity(integrator),sys))</code></pre><img src="5449b235.svg" alt="Example block output"/><p>For this problem, we can compare with the exact solution. The exact solution is also a Gaussian, but with a radius <span>$\sqrt{\sigma^2+4t/Re}$</span></p><pre><code class="language-julia hljs">oseen_exact(t) = SpatialGaussian(sqrt(σ^2+4*t/my_params[&quot;Re&quot;]),sqrt(σ^2+4*t/my_params[&quot;Re&quot;]),x0,y0,A)
exactsol(t) = init_sol(oseen_exact(t),sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">exactsol (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">plot(vorticity(integrator)[:,104],label=&quot;Numerical&quot;)
plot!(vorticity(exactsol(integrator.t),sys,integrator.t)[:,104],label=&quot;Exact&quot;)
plot!(title=string(&quot;Vorticity at t = &quot;,round(integrator.t,digits=2)))</code></pre><img src="c7802a3a.svg" alt="Example block output"/><h2 id="Second-example:-co-rotating-vortices"><a class="docs-heading-anchor" href="#Second-example:-co-rotating-vortices">Second example: co-rotating vortices</a><a id="Second-example:-co-rotating-vortices-1"></a><a class="docs-heading-anchor-permalink" href="#Second-example:-co-rotating-vortices" title="Permalink"></a></h2><p>The previous example is not very exciting, because the convection of the flow is simply circular. The next example is more interesting, because we will start with two vortices that influence each other&#39;s motion:</p><pre><code class="language-julia hljs">σ = 0.1
x01, y01 = 0.5, 0.0
x02, y02 = -0.5, 0.0
A = 1
twogauss = SpatialGaussian(σ,σ,x01,y01,A) + SpatialGaussian(σ,σ,x02,y02,A)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AddedFields:
  SpatialGaussian{false, 0}([0.010000000000000002 0.0; 0.0 0.010000000000000002], [99.99999999999999 -0.0; -0.0 99.99999999999999], [0.5, 0.0], 1.0, 15.915494309189533, [0.0, 0.0])
  SpatialGaussian{false, 0}([0.010000000000000002 0.0; 0.0 0.010000000000000002], [99.99999999999999 -0.0; -0.0 99.99999999999999], [-0.5, 0.0], 1.0, 15.915494309189533, [0.0, 0.0])
</code></pre><h3 id="Initialize-2"><a class="docs-heading-anchor" href="#Initialize-2">Initialize</a><a class="docs-heading-anchor-permalink" href="#Initialize-2" title="Permalink"></a></h3><p>Now, we create an instance of this vorticity distribution on the grid.</p><pre><code class="language-julia hljs">u0 = init_sol(twogauss,sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Dual nodes in a (nx = 208, ny = 208) cell grid of type Float64 data
  Number of Dual nodes: (nx = 208, ny = 208), Float64[])</code></pre><pre><code class="language-julia hljs">plot(vorticity(u0,sys,0.0),sys)</code></pre><img src="d432d897.svg" alt="Example block output"/><pre><code class="language-julia hljs">tspan = (0.0,8.0)
integrator = init(u0,tspan,sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">t: 0.0
u: (Dual nodes in a (nx = 208, ny = 208) cell grid of type Float64 data
  Number of Dual nodes: (nx = 208, ny = 208), Float64[])</code></pre><h3 id="Solve-2"><a class="docs-heading-anchor" href="#Solve-2">Solve</a><a class="docs-heading-anchor-permalink" href="#Solve-2" title="Permalink"></a></h3><p>Now we are ready to solve the problem. Let&#39;s advance the solution to <span>$t = 8$</span>:</p><pre><code class="language-julia hljs">step!(integrator,8.0)</code></pre><h3 id="Examine-2"><a class="docs-heading-anchor" href="#Examine-2">Examine</a><a class="docs-heading-anchor-permalink" href="#Examine-2" title="Permalink"></a></h3><p>In this case, it is best to view the results as an animation. In the previous example, we just looked at the final state of the integrator. Here, to animate, we will make use of the solution history that is held by the integrator, <code>integrator.sol</code>. Let&#39;s create an alias for this to shorten our commands:</p><pre><code class="language-julia hljs">sol = integrator.sol;</code></pre><p>The vortices orbit each other and then eventually merge together. If we wish to make a nice figure, we can arrange snapshots on a grid:</p><pre><code class="language-julia hljs">plt = plot(layout = (2,4), size = (800, 400), legend=:false)
tsnap = 0.0:1.0:7.0
for (i, t) in enumerate(tsnap)
    plot!(plt[i],vorticity(sol,sys,t),sys,levels=range(0.1,5,length=31))
end
savefig(plt,&quot;CoRotating.pdf&quot;)
plt</code></pre><img src="1958e1d6.svg" alt="Example block output"/><p>If you wish to animate the solution, e.g., plotting the vorticity every 5 steps you can use</p><pre><code class="nohighlight hljs">@gif for t in sol.t
   plot(vorticity(sol,sys,t),sys)
end every 5</code></pre><p><strong>Try other examples!</strong></p><ul><li>Make one or both of the vortices into elliptical shapes</li><li>Make one stronger than the other</li><li>Add other vortices into the initial distribution</li></ul><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../2.-Basic-flow-with-a-stationary-body/">Basic flow with a stationary body »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Wednesday 8 November 2023 18:29">Wednesday 8 November 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
