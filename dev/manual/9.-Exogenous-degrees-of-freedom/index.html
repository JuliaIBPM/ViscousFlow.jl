<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Exogenous degrees of freedom · ViscousFlow.jl</title><meta name="title" content="Exogenous degrees of freedom · ViscousFlow.jl"/><meta property="og:title" content="Exogenous degrees of freedom · ViscousFlow.jl"/><meta property="twitter:title" content="Exogenous degrees of freedom · ViscousFlow.jl"/><meta name="description" content="Documentation for ViscousFlow.jl."/><meta property="og:description" content="Documentation for ViscousFlow.jl."/><meta property="twitter:description" content="Documentation for ViscousFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ViscousFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../1.-Basic-viscous-flow/">Basic viscous flow</a></li><li><a class="tocitem" href="../2.-Basic-flow-with-a-stationary-body/">Basic flow with a stationary body</a></li><li><a class="tocitem" href="../3.-Applying-pulse-forcing-to-a-flow/">Applying pulse forcing to a flow</a></li><li><a class="tocitem" href="../4.-Multiple-stationary-bodies/">Multiple stationary bodies</a></li><li><a class="tocitem" href="../5.-Moving-reference-frame/">Moving reference frame</a></li><li><a class="tocitem" href="../6.-Viscous-flow-about-a-moving-body/">Viscous flow about moving bodies</a></li><li><a class="tocitem" href="../7.-Variable-free-stream/">Variable free stream</a></li><li><a class="tocitem" href="../8.-Lid-driven-cavity/">Lid-driven cavity flow</a></li><li class="is-active"><a class="tocitem" href>Exogenous degrees of freedom</a></li><li><a class="tocitem" href="../functions/">Functions and types</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Exogenous degrees of freedom</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Exogenous degrees of freedom</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl/blob/master/test/literate/9.-Exogenous-degrees-of-freedom.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Exogenous-degrees-of-freedom"><a class="docs-heading-anchor" href="#Exogenous-degrees-of-freedom">Exogenous degrees of freedom</a><a id="Exogenous-degrees-of-freedom-1"></a><a class="docs-heading-anchor-permalink" href="#Exogenous-degrees-of-freedom" title="Permalink"></a></h1><p>Thus far, the motion of bodies or of incident flows has been prescribed with time-varying functions known a priori. In other words, we knew in advance how the body or free stream would behave for all time. However, it is often the case that we do <em>not</em> know the motion in advance, because, e.g., that motion depends on the evolving state of the fluid flow. That is the case for fluid-body interactions, in which the body motion depends on the forces imparted by the fluid on the body. It is also the case for active feedback control or reinforcement learning, in which a controller/agent might change some degree of freedom based on what is observed.</p><p>We will refer to such a degree of freedom as <em>exogenous</em>. In this example, we will demonstrate how the package can incorporate exogenous degrees of freedom into the flow evolution. These exogenous states are specified by providing the value of their acceleration.</p><p>The example will be a flat plate in a steady free stream at nominally zero angle of incidence. However, the y acceleration will vary randomly. Since there is only a single body and it remains rigid, we will solve the problem in a reference frame moving with the body. However, exogenous degrees of freedom can be used in problems of arbitrary motion.</p><p>In this simple example, this exogenous y acceleration will not depend on anything, but it will be obvious from the example how it <em>could</em>.</p><pre><code class="language-julia hljs">using ViscousFlow</code></pre><pre><code class="language-julia hljs">using Plots</code></pre><p>Set the Reynolds number</p><pre><code class="language-julia hljs">my_params=Dict()
my_params[&quot;Re&quot;] = 200</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">200</code></pre><p>Set up the grid</p><pre><code class="language-julia hljs">xlim = (-2.0,4.0)
ylim = (-3.0,3.0)
my_params[&quot;grid Re&quot;] = 3.0
g = setup_grid(xlim,ylim,my_params)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PhysicalGrid{2}((405, 416), (136, 208), 0.015, ((-2.025, 4.02), (-3.105, 3.105)), 1)</code></pre><p>Set up the body</p><pre><code class="language-julia hljs">Δs = surface_point_spacing(g,my_params)
body = Plate(1.0,Δs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Open polygon with 2 vertices and 48 points
   Current position: (0.0,0.0)
   Current angle (rad): 0.0
</code></pre><h3 id="Kinematics"><a class="docs-heading-anchor" href="#Kinematics">Kinematics</a><a id="Kinematics-1"></a><a class="docs-heading-anchor-permalink" href="#Kinematics" title="Permalink"></a></h3><p>There won&#39;t be any rotation, so we will put the joint at the body&#39;s center.</p><pre><code class="language-julia hljs">parent_body, child_body = 0, 1
Xp = MotionTransform([0,0],0) # transform from inertial system to joint
xpiv = [0.0,0.0]
Xc = MotionTransform(xpiv,0.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2d motion transform, x = [0.0, 0.0], R = [1.0 0.0; -0.0 1.0]</code></pre><p>Now set the kinematics. Rather than provide a free stream, we will set the x velocity of the body to be -1. We will set the angular velocity to zero.</p><pre><code class="language-julia hljs">adof = ConstantVelocityDOF(0)
xdof = ConstantVelocityDOF(-1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Constant velocity kinematics (velocity = -1.0)</code></pre><p>Now, to designate the y degree of freedom as exogenous, we simply use</p><pre><code class="language-julia hljs">ydof = ExogenousDOF()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Exogeneously-specified DOF</code></pre><p>Now assemble the joint and the motion</p><pre><code class="language-julia hljs">dofs = [adof,xdof,ydof]
joint = Joint(FreeJoint2d,parent_body,Xp,child_body,Xc,dofs)
m = RigidBodyMotion(joint,body)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1 linked system(s) of bodies
   1 bodies
   1 joints
</code></pre><p>Set the boundary condition functions</p><pre><code class="language-julia hljs">function my_vsplus(t,x,base_cache,phys_params,motions)
  vsplus = zeros_surface(base_cache)
  surface_velocity_in_translating_frame!(vsplus,x,base_cache,motions,t)
  return vsplus
end

function my_vsminus(t,x,base_cache,phys_params,motions)
  vsminus = zeros_surface(base_cache)
  surface_velocity_in_translating_frame!(vsminus,x,base_cache,motions,t)
  return vsminus
end

bcdict = Dict(&quot;exterior&quot; =&gt; my_vsplus, &quot;interior&quot; =&gt; my_vsminus)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Function} with 2 entries:
  &quot;interior&quot; =&gt; my_vsminus
  &quot;exterior&quot; =&gt; my_vsplus</code></pre><h3 id="Construct-system-and-initialize"><a class="docs-heading-anchor" href="#Construct-system-and-initialize">Construct system and initialize</a><a id="Construct-system-and-initialize-1"></a><a class="docs-heading-anchor-permalink" href="#Construct-system-and-initialize" title="Permalink"></a></h3><pre><code class="language-julia hljs">sys = viscousflow_system(g,body,phys_params=my_params,bc=bcdict,motions=m,reference_body=1);

u0 = init_sol(sys)
tspan = (0.0,10.0)
integrator = init(u0,tspan,sys)
dt = timestep(u0,sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0075</code></pre><h3 id="Solve"><a class="docs-heading-anchor" href="#Solve">Solve</a><a id="Solve-1"></a><a class="docs-heading-anchor-permalink" href="#Solve" title="Permalink"></a></h3><p>To solve the problem, we advance the solution inside a loop. The timestep with which we advance is up to us, though it should be an integer multiple of the timestep used by the underlying solver (<code>dt</code> above). This prevents the need for expensive interpolations. We will simply set it to <code>dt</code> here.</p><p>Inside the loop, we update the value of the exogenous acceleration, using the <code>update_exogenous!</code> function. This is done with a vector of all such exogenous states, though there is only one state in this example. We draw its value from a normal distribution.</p><pre><code class="language-julia hljs">dt_advance = dt
tfinal = 2.5
for t in 0:dt_advance:tfinal
    a_y = randn()
    update_exogenous!(integrator,[a_y])
    step!(integrator,dt_advance)
end</code></pre><h3 id="Plot-it"><a class="docs-heading-anchor" href="#Plot-it">Plot it</a><a id="Plot-it-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-it" title="Permalink"></a></h3><p>Plot the vorticity field</p><pre><code class="language-julia hljs">sol = integrator.sol
plt = plot(layout = (4,3), size = (900, 900), legend=:false)
tsnap = tfinal/12:tfinal/12:tfinal
for (i, t) in enumerate(tsnap)
    plot!(plt[i],vorticity(sol,sys,t),sys,clim=(-20,20),levels=range(-20,20,length=16),ylim=(-1.5,1.5),title=&quot;$(round(t,digits=4))&quot;)
end
plt</code></pre><img src="c643f755.svg" alt="Example block output"/><p>and compute and plot the force and moment</p><pre><code class="language-julia hljs">mom, fx, fy = force(sol,sys,1)

plot(
plot(sol.t,2*fx,xlim=(0,Inf),ylim=(-5,5),xlabel=&quot;\$t\$&quot;,ylabel=&quot;\$C_x\$&quot;,legend=:false),
plot(sol.t,2*fy,xlim=(0,Inf),ylim=(-5,5),xlabel=&quot;\$t\$&quot;,ylabel=&quot;\$C_y\$&quot;,legend=:false),
plot(sol.t,2*mom,xlim=(0,Inf),ylim=(-2,2),xlabel=&quot;\$t\$&quot;,ylabel=&quot;\$C_m\$&quot;,legend=:false),
    size=(800,350)
)</code></pre><img src="67859a1d.svg" alt="Example block output"/><p>We can also look at the y position and velocity. These are contained in the joint state vector, <code>aux_state(u)</code>. We can use the functions <code>exogenous_position_vector</code> and <code>exogenous_velocity_vector</code> to access them. (The index <code>[1]</code> below is required because these functions return a vector of exogenous states for a particular joint. There is only one component that is exogenous in this example.</p><pre><code class="language-julia hljs">jointid = 1
y = map(u -&gt; exogenous_position_vector(aux_state(u),m,jointid)[1],sol)
v = map(u -&gt; exogenous_velocity_vector(aux_state(u),m,jointid)[1],sol)
plot(sol.t,y,label=&quot;\$y\$&quot;,xlabel=&quot;\$t\$&quot;)
plot!(sol.t,v,label=&quot;\$v\$&quot;)</code></pre><img src="d640e664.svg" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../8.-Lid-driven-cavity/">« Lid-driven cavity flow</a><a class="docs-footer-nextpage" href="../functions/">Functions and types »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Tuesday 1 July 2025 04:14">Tuesday 1 July 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
