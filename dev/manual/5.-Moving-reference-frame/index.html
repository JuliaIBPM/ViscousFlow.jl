<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Moving reference frame · ViscousFlow.jl</title><meta name="title" content="Moving reference frame · ViscousFlow.jl"/><meta property="og:title" content="Moving reference frame · ViscousFlow.jl"/><meta property="twitter:title" content="Moving reference frame · ViscousFlow.jl"/><meta name="description" content="Documentation for ViscousFlow.jl."/><meta property="og:description" content="Documentation for ViscousFlow.jl."/><meta property="twitter:description" content="Documentation for ViscousFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ViscousFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../1.-Basic-viscous-flow/">Basic viscous flow</a></li><li><a class="tocitem" href="../2.-Basic-flow-with-a-stationary-body/">Basic flow with a stationary body</a></li><li><a class="tocitem" href="../3.-Applying-pulse-forcing-to-a-flow/">Applying pulse forcing to a flow</a></li><li><a class="tocitem" href="../4.-Multiple-stationary-bodies/">Multiple stationary bodies</a></li><li class="is-active"><a class="tocitem" href>Moving reference frame</a><ul class="internal"><li><a class="tocitem" href="#Create-the-plate"><span>Create the plate</span></a></li><li><a class="tocitem" href="#Set-the-kinematics"><span>Set the kinematics</span></a></li></ul></li><li><a class="tocitem" href="../6.-Viscous-flow-about-a-moving-body/">Viscous flow about moving bodies</a></li><li><a class="tocitem" href="../7.-Variable-free-stream/">Variable free stream</a></li><li><a class="tocitem" href="../8.-Lid-driven-cavity/">Lid-driven cavity flow</a></li><li><a class="tocitem" href="../9.-Exogenous-degrees-of-freedom/">Exogenous degrees of freedom</a></li><li><a class="tocitem" href="../functions/">Functions and types</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Moving reference frame</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Moving reference frame</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl/blob/master/test/literate/5.-Moving-reference-frame.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Moving-reference-frame"><a class="docs-heading-anchor" href="#Moving-reference-frame">Moving reference frame</a><a id="Moving-reference-frame-1"></a><a class="docs-heading-anchor-permalink" href="#Moving-reference-frame" title="Permalink"></a></h1><p>As will be discussed in <a href="../6.-Viscous-flow-about-a-moving-body/#Viscous-flow-about-moving-bodies">Viscous flow about moving bodies</a>, it is slower to solve the problem when the body moves in our frame of reference, because it requires re-generating the grid operations at each time step. However, when we only have a single rigid body, we can solve the problem in a frame of reference moving with the body. In this manner, the body remains invariantly mmersed in the grid, so the problem is faster to solve.</p><p>We will demonstrate how to solve a problem in a moving reference frame in this notebook. First, we need some notation, given by the diagram below:</p><p><img src="../assets/comoving-diagram.svg" alt="comoving-diagram.svg"/></p><p>The main idea is that we wish to solve the problem in the <span>$(\hat{x},\hat{y})$</span> reference frame, moving with the body. In that reference frame, the translational <span>$\mathbf{U}_p$</span> and rotational <span>$\Omega$</span> motion of the body appear as effects at infinity. This is fine for the translational part – it&#39;s equivalent to a freestream velocity. However, it is problematic for the rotational part in external flows, because the velocity&#39;s magnitude grows with distance from the center of rotation. Instead, we solve for the velocity expressed relative to the translating frame, but <em>not the rotating frame</em>. However, the components of this velocity are still expressed in the rotating coordinate system, <span>$\hat{x}$</span> and <span>$\hat{y}$</span>, which is the key to allowing us to keep the body fixed in the computational domain.</p><p>Mathematically, we write this velocity as <span>$\mathbf{u}&#39; = R^T (\mathbf{u} - \mathbf{U}_p)$</span>. where <span>$R$</span> is the rotation operator from the rotating to the inertial coordinate system. The boundary conditions on <span>$\mathbf{u}&#39;$</span> are <span>$-R^T \mathbf{U}_p$</span> at infinity (a freestream), and <span>$\mathbf{u}&#39; = \Omega \times (\mathbf{x}-\mathbf{X}_p)$</span> on the surface of the body.</p><p>To set the problem up, we simply need to supply the kinematics of the motion, and to provide an additional argument <code>reference_body = 1</code>, which signals that we wish to solve the problem in a coordinate system moving with body 1. The default value of this argument is 0, the inertial coordinate system.</p><p>Here, we will demonstrate this on a problem involving the flapping of a flat plate. (This is a simple model for hovering insect flight, if you&#39;re interested!)</p><pre><code class="language-julia hljs">using ViscousFlow</code></pre><pre><code class="language-julia hljs">using Plots</code></pre><p>Let&#39;s define a macro that allows us to visualize the kinematics of the body from the perspective of the inertial reference frame.</p><pre><code class="language-julia hljs">macro animate_motion(b,m,dt,tmax,xlim,ylim)
    return esc(quote
            bc = deepcopy($b)
            t0, x0 = 0.0, init_motion_state(bc,$m)
            dxdt = zero(x0)
            x = copy(x0)
            @gif for t in t0:$dt:t0+$tmax
                motion_rhs!(dxdt,x,($m,bc),t)
                global x += dxdt*$dt
                update_body!(bc,x,$m)
                plot(bc,xlims=$xlim,ylims=$ylim)
            end every 5
        end)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">@animate_motion (macro with 1 method)</code></pre><p>Set the Reynolds number</p><pre><code class="language-julia hljs">my_params=Dict()
my_params[&quot;Re&quot;] = 100</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100</code></pre><p>Create a domain big enough to hold the vorticity. We will loosen the grid Re a bit.</p><pre><code class="language-julia hljs">xlim = (-4.0,4.0)
ylim = (-3.5,2.0)
my_params[&quot;grid Re&quot;] = 3.0
g = setup_grid(xlim,ylim,my_params)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PhysicalGrid{2}((270, 192), (135, 121), 0.03, ((-4.02, 4.02), (-3.5999999999999996, 2.1)), 4)</code></pre><h2 id="Create-the-plate"><a class="docs-heading-anchor" href="#Create-the-plate">Create the plate</a><a id="Create-the-plate-1"></a><a class="docs-heading-anchor-permalink" href="#Create-the-plate" title="Permalink"></a></h2><p>We create the body as usual. However, in order to facilitate the kinematics that follow, it is helpful to change the body&#39;s intrinsic coordinate system from its default system – in which the plate lies along its own x axis – to another system in which the plate lies along its y axis. This is not necessary, but it has some benefits for prescribing the motion and for visualizing the results.</p><p>To make this change of body coordinate system, we use the <a href="https://juliaibpm.github.io/RigidBodyTools.jl/stable/manual/transforms/#RigidBodyTools.transform_body!"><code>transform_body!</code></a> function. This is different from <a href="https://juliaibpm.github.io/RigidBodyTools.jl/stable/manual/transforms/#RigidBodyTools.update_body!"><code>update_body!</code></a>, because the latter only changes the body&#39;s placement in the inertial system. To use the function, we specify a <code>MotionTransform</code> with where we want the plate to lie and at what angle.</p><pre><code class="language-julia hljs">Δs = surface_point_spacing(g,my_params)
body = Plate(1.0,Δs)
X = MotionTransform([0,0],π/2)
transform_body!(body,X)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Open polygon with 2 vertices and 24 points
   Current position: (0.0,0.0)
   Current angle (rad): 1.5707963267948966
</code></pre><p>Plot it, just to check.</p><pre><code class="language-julia hljs">plot(body,xlim=xlim,ylim=ylim)</code></pre><img src="a8a21dd7.svg" alt="Example block output"/><h2 id="Set-the-kinematics"><a class="docs-heading-anchor" href="#Set-the-kinematics">Set the kinematics</a><a id="Set-the-kinematics-1"></a><a class="docs-heading-anchor-permalink" href="#Set-the-kinematics" title="Permalink"></a></h2><p>Here, we will define the kinematics. The wing will pitch about an axis at its top edge, as in the figure below</p><p><img src="../assets/flat-plate-diagram.svg" alt="flat-plate-diagram.svg"/></p><p>Thus, <span>$\hat{X}_p = (0,0.5c)$</span>. Since the length of the plate is 1, we are implicitly scaling the problem by <span>$c$</span>, so we will set this joint at <span>$(0,0.5)$</span> in these coordinates.</p><h3 id="The-joint-placement"><a class="docs-heading-anchor" href="#The-joint-placement">The joint placement</a><a id="The-joint-placement-1"></a><a class="docs-heading-anchor-permalink" href="#The-joint-placement" title="Permalink"></a></h3><p>We must specify the joint, attaching body 1 (the child) to the inertial system (body 0, the parent). We need a more detailed form of the <code>Joint</code> function now. In this form, we need to specify how the joint is attached to each body, and how each of its degrees of freedom move. We will do this piece by piece to explain it. More details can be found in the documentation for <a href="https://github.com/JuliaIBPM/RigidBodyTools.jl">RigidBodyTools.jl</a>.</p><p>To place the joint, we need to specify its position in both the parent&#39;s and the child&#39;s coordinate systems. In the parent&#39;s system, we can just place it at the origin, with no rotation. For the child, we place the joint as desired, at <span>$(0,0.5)$</span>.</p><pre><code class="language-julia hljs">parent_body, child_body = 0, 1
Xp = MotionTransform([0,0],0) # transform from inertial system to joint
xpiv = [0.0,0.5]
Xc = MotionTransform(xpiv,0.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2d motion transform, x = [0.0, 0.5], R = [1.0 0.0; -0.0 1.0]</code></pre><h3 id="The-kinematics"><a class="docs-heading-anchor" href="#The-kinematics">The kinematics</a><a id="The-kinematics-1"></a><a class="docs-heading-anchor-permalink" href="#The-kinematics" title="Permalink"></a></h3><p>We are creating a joint that has three potential degrees of freedom (angle, x, y), called a <code>FreeJoint2d</code>. However, only the angle and x coordinates of the joint will be allowed to move. Both of these are assigned oscillatory kinematics.</p><pre><code class="language-julia hljs">Ω = π/2 # Flapping angular frequency
Tp = 2π/Ω # Period of flapping
Δα = π/4 # Amplitude of pitching
ϕα = 0 # Pitching phase
adof = OscillatoryDOF(Δα,Ω,ϕα,0.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Oscillatory kinematics (amplitude = 0.7853981633974483, ang freq = 1.5707963267948966, phase = 0.0, mean velocity = 0.0)</code></pre><p>The motion of the x coordinate</p><pre><code class="language-julia hljs">A = 1 # Heaving amplitude
ϕ = -π/2 # Phase lag
xdof = OscillatoryDOF(A,Ω,ϕ,0.0)

ydof = ConstantVelocityDOF(0) # Keep the y coordinate fixed</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Constant velocity kinematics (velocity = 0.0)</code></pre><p>We put the kinematics into a vector. The degrees of freedom are always ordered <code>[rotation, x, y]</code>.</p><pre><code class="language-julia hljs">dofs = [adof,xdof,ydof]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{AbstractPrescribedDOFKinematics}:
 Oscillatory kinematics (amplitude = 0.7853981633974483, ang freq = 1.5707963267948966, phase = 0.0, mean velocity = 0.0)
 Oscillatory kinematics (amplitude = 1.0, ang freq = 1.5707963267948966, phase = -1.5707963267948966, mean velocity = 0.0)
 Constant velocity kinematics (velocity = 0.0)</code></pre><p>Finally, create the joint and the motion structure.</p><pre><code class="language-julia hljs">joint = Joint(FreeJoint2d,parent_body,Xp,child_body,Xc,dofs)
m = RigidBodyMotion(joint,body)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1 linked system(s) of bodies
   1 bodies
   1 joints
</code></pre><p>Now animate the motion for a complete cycle (4 time units)</p><pre><code class="language-julia hljs">@animate_motion body m Tp/200 Tp xlim ylim</code></pre><img src="ccff0fe3.gif" alt="Example block output"/><h3 id="Boundary-condition-functions"><a class="docs-heading-anchor" href="#Boundary-condition-functions">Boundary condition functions</a><a id="Boundary-condition-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-condition-functions" title="Permalink"></a></h3><p>Instead of using the default boundary condition functions, we define special ones here that provide the instantaneous surface velocity (i.e. the velocity of every surface point) from the prescribed motion. Every surface has an &quot;exterior&quot; and &quot;interior&quot; side. For a flat plate, these two sides are the upper and lower sides, and both sides are next to the fluid, so both of them are assigned the prescribed velocity of the plate. (For closed bodies, we would assign this velocity to only one of the sides, and zero to the other side. We will see an example of this in a later case.) We pack these into a special dictionary and pass these to the system construction.</p><p>We need to provide specialized boundary conditions for this problem, and we use the function <code>surface_velocity_in_translating_frame!</code> for that. Because we are simulating a flat plate, both the positive and negative sides of the surface must have their boundary velocities set the same way. If this were instead a closed body, we would set either the positive or negative side&#39;s value to zero. We pack these into a special dictionary and pass these to the system construction.</p><pre><code class="language-julia hljs">function my_vsplus(t,x,base_cache,phys_params,motions)
  vsplus = zeros_surface(base_cache)
  surface_velocity_in_translating_frame!(vsplus,x,base_cache,motions,t)
  return vsplus
end

function my_vsminus(t,x,base_cache,phys_params,motions)
  vsminus = zeros_surface(base_cache)
  surface_velocity_in_translating_frame!(vsminus,x,base_cache,motions,t)
  return vsminus
end

bcdict = Dict(&quot;exterior&quot; =&gt; my_vsplus, &quot;interior&quot; =&gt; my_vsminus)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Function} with 2 entries:
  &quot;interior&quot; =&gt; my_vsminus
  &quot;exterior&quot; =&gt; my_vsplus</code></pre><h3 id="Construct-the-system-structure"><a class="docs-heading-anchor" href="#Construct-the-system-structure">Construct the system structure</a><a id="Construct-the-system-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Construct-the-system-structure" title="Permalink"></a></h3><p>Here, we supply both the motion, the boundary condition functions, and the reference body as additional arguments.</p><pre><code class="language-julia hljs">sys = viscousflow_system(g,body,phys_params=my_params,bc=bcdict,motions=m,reference_body=1);</code></pre><h3 id="Set-up-the-initial-conditions"><a class="docs-heading-anchor" href="#Set-up-the-initial-conditions">Set up the initial conditions</a><a id="Set-up-the-initial-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-the-initial-conditions" title="Permalink"></a></h3><p>This is done the usual way</p><pre><code class="language-julia hljs">u0 = init_sol(sys)
tspan = (0.0,10.0)
integrator = init(u0,tspan,sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">t: 0.0
u: (Dual nodes in a (nx = 270, ny = 192) cell grid of type Float64 data
  Number of Dual nodes: (nx = 270, ny = 192), [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 1.0, 0.0])</code></pre><h3 id="Solve-the-problem"><a class="docs-heading-anchor" href="#Solve-the-problem">Solve the problem</a><a id="Solve-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-the-problem" title="Permalink"></a></h3><p>Here, we will advance it for one flapping period</p><pre><code class="language-julia hljs">step!(integrator,Tp)</code></pre><h3 id="Plot-it"><a class="docs-heading-anchor" href="#Plot-it">Plot it</a><a id="Plot-it-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-it" title="Permalink"></a></h3><p>Plot the vorticity field</p><pre><code class="language-julia hljs">sol = integrator.sol
plt = plot(layout = (4,3), size = (900, 900), legend=:false)
tsnap = Tp/12:Tp/12:Tp
for (i, t) in enumerate(tsnap)
    plot!(plt[i],vorticity(sol,sys,t),sys,clim=(-20,20),levels=range(-20,20,length=16),ylim=(-3.5,1.5),title=&quot;$(round(t/Tp,digits=4))Tp&quot;)
end
plt</code></pre><img src="fd3980d6.svg" alt="Example block output"/><h3 id="Plot-the-forces-and-moments"><a class="docs-heading-anchor" href="#Plot-the-forces-and-moments">Plot the forces and moments</a><a id="Plot-the-forces-and-moments-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-forces-and-moments" title="Permalink"></a></h3><p>The solution is expressed in co-rotating coordinates. To get the force and moment in inertial coordinates, we make use of the <code>axes</code> keyword, setting it to 0. The moment is computed about the center of the body&#39;s coordinate system, but we can change that behavior by using the <code>force_reference</code> keyword, setting it to 0, for example, to compute the moment about the origin of the inertial system.</p><pre><code class="language-julia hljs">mom, fx, fy = force(sol,sys,1,axes=0);</code></pre><p>Plot these</p><pre><code class="language-julia hljs">plot(
plot(sol.t/Tp,2*fx/Ω^2,xlim=(0,Inf),ylim=(-5,5),xlabel=&quot;\$t/T_p\$&quot;,ylabel=&quot;\$C_D\$&quot;,legend=:false),
plot(sol.t/Tp,2*fy/Ω^2,xlim=(0,Inf),ylim=(-2,5),xlabel=&quot;\$t/T_p\$&quot;,ylabel=&quot;\$C_L\$&quot;,legend=:false),
plot(sol.t/Tp,2*mom/Ω^2,xlim=(0,Inf),ylim=(-2,2),xlabel=&quot;\$t/T_p\$&quot;,ylabel=&quot;\$C_m\$&quot;,legend=:false),
    size=(800,350)
)</code></pre><img src="b8fb3dd7.svg" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../4.-Multiple-stationary-bodies/">« Multiple stationary bodies</a><a class="docs-footer-nextpage" href="../6.-Viscous-flow-about-a-moving-body/">Viscous flow about moving bodies »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.0 on <span class="colophon-date" title="Thursday 30 November 2023 21:55">Thursday 30 November 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
