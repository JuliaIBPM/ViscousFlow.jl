<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic flow with a stationary body · ViscousFlow.jl</title><meta name="title" content="Basic flow with a stationary body · ViscousFlow.jl"/><meta property="og:title" content="Basic flow with a stationary body · ViscousFlow.jl"/><meta property="twitter:title" content="Basic flow with a stationary body · ViscousFlow.jl"/><meta name="description" content="Documentation for ViscousFlow.jl."/><meta property="og:description" content="Documentation for ViscousFlow.jl."/><meta property="twitter:description" content="Documentation for ViscousFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ViscousFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../1.-Basic-viscous-flow/">Basic viscous flow</a></li><li class="is-active"><a class="tocitem" href>Basic flow with a stationary body</a></li><li><a class="tocitem" href="../3.-Applying-pulse-forcing-to-a-flow/">Applying pulse forcing to a flow</a></li><li><a class="tocitem" href="../4.-Multiple-stationary-bodies/">Multiple stationary bodies</a></li><li><a class="tocitem" href="../5.-Moving-reference-frame/">Moving reference frame</a></li><li><a class="tocitem" href="../6.-Viscous-flow-about-a-moving-body/">Viscous flow about moving bodies</a></li><li><a class="tocitem" href="../7.-Variable-free-stream/">Variable free stream</a></li><li><a class="tocitem" href="../8.-Lid-driven-cavity/">Lid-driven cavity flow</a></li><li><a class="tocitem" href="../9.-Exogenous-degrees-of-freedom/">Exogenous degrees of freedom</a></li><li><a class="tocitem" href="../functions/">Functions and types</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Basic flow with a stationary body</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic flow with a stationary body</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ViscousFlow.jl/blob/master/test/literate/2.-Basic-flow-with-a-stationary-body.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-flow-with-a-stationary-body"><a class="docs-heading-anchor" href="#Basic-flow-with-a-stationary-body">Basic flow with a stationary body</a><a id="Basic-flow-with-a-stationary-body-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-flow-with-a-stationary-body" title="Permalink"></a></h1><p>In this notebook we will simulate the flow past a stationary body.</p><pre><code class="language-julia hljs">using ViscousFlow</code></pre><pre><code class="language-julia hljs">using Plots
using Statistics</code></pre><h3 id="The-basic-steps"><a class="docs-heading-anchor" href="#The-basic-steps">The basic steps</a><a id="The-basic-steps-1"></a><a class="docs-heading-anchor-permalink" href="#The-basic-steps" title="Permalink"></a></h3><p>From the previous notebook, we add one additional step:</p><ul><li><strong>Specify the problem</strong>: Set the Reynolds number, the free stream, and any other problem parameters</li><li><strong>Discretize</strong>: Set up a solution domain, choose the grid Reynolds number and the critical time step limits</li><li>***Set up bodies***: <em>Create the body or bodies and specify their motions, if any</em></li><li><strong>Construct the system structure</strong>: Create the operators that will be used to perform the simulation</li><li><strong>Initialize</strong>: Set the initial flow field and initialize the integrator</li><li><strong>Solve</strong>: Solve the flow field</li><li><strong>Examine</strong>: Examine the results</li></ul><p>The rest of the steps are nearly the same as in the previous example.</p><p>As before, we initialize the parameters dictionary:</p><pre><code class="language-julia hljs">my_params = Dict()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Any, Any}()</code></pre><h3 id="Problem-specification"><a class="docs-heading-anchor" href="#Problem-specification">Problem specification</a><a id="Problem-specification-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-specification" title="Permalink"></a></h3><p>Set the Reynolds number and free stream. We will set the free stream to be in the <span>$x$</span> direction, with speed equal to 1.</p><pre><code class="language-julia hljs">my_params[&quot;Re&quot;] = 200
my_params[&quot;freestream speed&quot;] = 1.0
my_params[&quot;freestream angle&quot;] = 0.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0</code></pre><h3 id="Discretize"><a class="docs-heading-anchor" href="#Discretize">Discretize</a><a id="Discretize-1"></a><a class="docs-heading-anchor-permalink" href="#Discretize" title="Permalink"></a></h3><p>We set the grid Re to 4.0 here to get a quicker solution, though it is generally better to make this smaller (it defaults to 2.0).</p><pre><code class="language-julia hljs">xlim = (-1.0,5.0)
ylim = (-2.0,2.0)
my_params[&quot;grid Re&quot;] = 4.0
g = setup_grid(xlim,ylim,my_params)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PhysicalGrid{2}((308, 208), (53, 104), 0.02, ((-1.04, 5.08), (-2.06, 2.06)), 1)</code></pre><h3 id="Set-up-bodies"><a class="docs-heading-anchor" href="#Set-up-bodies">Set up bodies</a><a id="Set-up-bodies-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-bodies" title="Permalink"></a></h3><p>Here, we will set up a rectangle of half-height 0.5 and half-width 0.25 at 45 degrees angle of attack. We also need to supply the spacing between points. For this, we use the function <a href="../functions/#ViscousFlow.surface_point_spacing-Tuple{PhysicalGrid, Any}"><code>surface_point_spacing</code></a></p><pre><code class="language-julia hljs">Δs = surface_point_spacing(g,my_params)
body = Rectangle(0.5,0.25,Δs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Closed polygon with 4 vertices and 108 points
   Current position: (0.0,0.0)
   Current angle (rad): 0.0
</code></pre><p>We place the body at a desired location and orientation by creating a <em>joint</em>. This joint &quot;joins&quot; the body to the inertial coordinate system. In order to create this joint and apply it, we first need to place the joint in the inertial coordinate system with a <code>MotionTransform</code>.</p><pre><code class="language-julia hljs">cent = [0.0,0.0] # center of joint with respect to inertial system
α = 45π/180 # angle of joint with respect to inertial system
X = MotionTransform(cent,α)
joint = Joint(X)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Joint of dimension 2 and type FreeJoint2d
   Constrained dofs = [1, 2, 3]
   Exogenous dofs = Int64[]
   Unconstrained dofs = Int64[]
</code></pre><p>The next two steps will seem unnecessarily cumbersome, but they reveal an important aspect of how this package treats surface motion. Every problem with bodies has joints, and every joint has at least one degree of freedom, even if none of these degrees of freedom is meant to vary in time.</p><p>For this reason, we must always create a <code>RigidBodyMotion</code> object and a <em>joint state vector</em>, <code>x</code>, even if there is no motion. In this example, <code>x</code> is just a vector of 3 zeros (describing the angle, x, and y coordinates of the joint).</p><p>To set the body in place, we use <code>update_body!(body,x,m)</code>. After the operation is applied, <code>body</code> is transformed to the correct location/orientation.</p><pre><code class="language-julia hljs">m = RigidBodyMotion(joint,body)
x = init_motion_state(body,m)
update_body!(body,x,m)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Closed polygon with 4 vertices and 108 points
   Current position: (0.0,0.0)
   Current angle (rad): 0.7853981633974483
</code></pre><p>Let&#39;s plot it just to make sure</p><pre><code class="language-julia hljs">plot(body,xlim=xlim,ylim=ylim)</code></pre><img src="1a3d6cf4.svg" alt="Example block output"/><h3 id="Construct-the-system-structure"><a class="docs-heading-anchor" href="#Construct-the-system-structure">Construct the system structure</a><a id="Construct-the-system-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Construct-the-system-structure" title="Permalink"></a></h3><p>This step is like the previous notebook, but now we also provide the body as an argument. It is important to note that we have not provided any explicit information about the boundary conditions on our shape. It therefore assumes that we want to enforce zero velocity on the shape. We will show another example later in which we change this. Note that we have to supply the <code>RigidBodyMotion</code> object via the <code>motions</code> keyword.</p><pre><code class="language-julia hljs">sys = viscousflow_system(g,body,phys_params=my_params,motions=m);</code></pre><h3 id="Initialize"><a class="docs-heading-anchor" href="#Initialize">Initialize</a><a id="Initialize-1"></a><a class="docs-heading-anchor-permalink" href="#Initialize" title="Permalink"></a></h3><p>Now, we initialize with zero vorticity. Note that we do this by calling <code>init_sol</code> with no argument except for <code>sys</code> itself.</p><pre><code class="language-julia hljs">u0 = init_sol(sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Dual nodes in a (nx = 308, ny = 208) cell grid of type Float64 data
  Number of Dual nodes: (nx = 308, ny = 208), [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0])</code></pre><p>and now create the integrator, with a long enough time span to hold the whole solution history:</p><pre><code class="language-julia hljs">tspan = (0.0,20.0)
integrator = init(u0,tspan,sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">t: 0.0
u: (Dual nodes in a (nx = 308, ny = 208) cell grid of type Float64 data
  Number of Dual nodes: (nx = 308, ny = 208), [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0])</code></pre><h3 id="Solve"><a class="docs-heading-anchor" href="#Solve">Solve</a><a id="Solve-1"></a><a class="docs-heading-anchor-permalink" href="#Solve" title="Permalink"></a></h3><p>Now we are ready to solve the problem. Let&#39;s advance the solution to <span>$t = 1$</span>.</p><pre><code class="language-julia hljs">@time step!(integrator,1.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"> 13.622514 seconds (5.61 M allocations: 1.986 GiB, 0.90% gc time, 49.78% compilation time)</code></pre><h3 id="Examine"><a class="docs-heading-anchor" href="#Examine">Examine</a><a id="Examine-1"></a><a class="docs-heading-anchor-permalink" href="#Examine" title="Permalink"></a></h3><p>Let&#39;s look at the flow field at the end of this interval</p><pre><code class="language-julia hljs">plot(
plot(vorticity(integrator),sys,title=&quot;Vorticity&quot;,clim=(-15,15),levels=range(-15,15,length=30), color = :RdBu,ylim=ylim),
plot(streamfunction(integrator),sys,title=&quot;Streamlines&quot;,ylim=ylim,color = :Black),
    size=(700,300)
    )</code></pre><img src="35b05495.svg" alt="Example block output"/><h4 id="Compute-the-moment-and-force-histories"><a class="docs-heading-anchor" href="#Compute-the-moment-and-force-histories">Compute the moment and force histories</a><a id="Compute-the-moment-and-force-histories-1"></a><a class="docs-heading-anchor-permalink" href="#Compute-the-moment-and-force-histories" title="Permalink"></a></h4><p>To do this, we supply the solution history <code>sol</code>, the system <code>sys</code>, and the index of the body (1).</p><pre><code class="language-julia hljs">sol = integrator.sol;
mom, fx, fy = force(sol,sys,1);</code></pre><p>Plot the histories. Note that we are actually plotting the drag and lift coefficient histories here: $ C<em>D = \dfrac{F</em>x}{\frac{1}{2}\rho U<em>\infty^2 L}, \quad C</em>L = \dfrac{F<em>y}{\frac{1}{2}\rho U</em>\infty^2 L}, \quad C<em>m = \dfrac{M}{\frac{1}{2}\rho U</em>\infty^2 L^2} $ Since the quantities in this simulation are already scaled by <span>$\rho$</span>, <span>$U_\infty$</span>, and <span>$L$</span> (because <span>$\rho$</span> has been scaled out of the equations, and the free stream speed is set to 1 and the height of the shape to 1), then we obtain these coefficients by simply dividing by 1/2, or equivalently, by multiplying by 2:</p><pre><code class="language-julia hljs">plot(
plot(sol.t,2*fx,xlim=(0,Inf),ylim=(0,4),xlabel=&quot;Convective time&quot;,ylabel=&quot;\$C_D\$&quot;,legend=:false),
plot(sol.t,2*fy,xlim=(0,Inf),ylim=(-4,4),xlabel=&quot;Convective time&quot;,ylabel=&quot;\$C_L\$&quot;,legend=:false),
plot(sol.t,2*mom,xlim=(0,Inf),ylim=(-4,4),xlabel=&quot;Convective time&quot;,ylabel=&quot;\$C_m\$&quot;,legend=:false),
    size=(800,350)
)</code></pre><img src="ac4fbf47.svg" alt="Example block output"/><p>The mean drag and lift coefficients (omitting the first two steps) are</p><pre><code class="language-julia hljs">meanCD = mean(2*fx[3:end])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2.123193095975185</code></pre><pre><code class="language-julia hljs">meanCL = mean(2*fy[3:end])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-0.7050286530831306</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.-Basic-viscous-flow/">« Basic viscous flow</a><a class="docs-footer-nextpage" href="../3.-Applying-pulse-forcing-to-a-flow/">Applying pulse forcing to a flow »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Sunday 22 December 2024 02:16">Sunday 22 December 2024</span>. Using Julia version 1.10.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
